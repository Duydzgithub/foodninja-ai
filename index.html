<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FoodNinja - Nh·∫≠n di·ªán m√≥n ƒÉn</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="modern.css" />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icon.svg" type="image/svg+xml">
</head>
<body>
  <div class="container">
    <h1 class="title">üçΩÔ∏è FoodNinja</h1>
    <p class="subtitle">Nh·∫≠n di·ªán m√≥n ƒÉn &amp; t∆∞ v·∫•n dinh d∆∞·ª°ng hi·ªán ƒë·∫°i</p>

    <div class="main-content">
      <!-- C·ªôt thao t√°c: Upload/Camera/Drag & Drop -->
      <div class="action-col">
        <div id="uploadBox" class="upload-box" tabindex="0" role="button" aria-label="K√©o th·∫£ ho·∫∑c ch·ªçn ·∫£nh ƒë·ªÉ nh·∫≠n di·ªán">
          <span class="upload-icon" aria-hidden="true">üì∑</span>
          <label for="imageInput" class="sr-only">Ch·ªçn ·∫£nh ƒë·ªÉ nh·∫≠n di·ªán th·ª±c ph·∫©m</label>
          <input type="file" id="imageInput" accept="image/*" capture="environment" class="hidden-input" title="Ch·ªçn ·∫£nh th·ª±c ph·∫©m" placeholder="Ch·ªçn ·∫£nh th·ª±c ph·∫©m" />
          <button id="uploadBtn" class="btn btn-accent" type="button">T·∫£i ·∫£nh l√™n</button>
          <span class="or">ho·∫∑c</span>
          <button id="cameraBtn" class="btn btn-main" type="button">Ch·ª•p ·∫£nh</button>
        </div>
        <div class="help-text">K√©o & th·∫£ ·∫£nh v√†o khung tr√™n ƒë·ªÉ nh·∫≠n di·ªán nhanh</div>

        <div class="media-frame-wrapper">
          <video id="video" class="hidden media-frame" autoplay playsinline muted title="Camera feed ƒë·ªÉ ch·ª•p ·∫£nh th·ª±c ph·∫©m"></video>
          <canvas id="canvas" class="hidden media-frame" aria-label="·∫¢nh ƒë√£ ch·ª•p t·ª´ camera"></canvas>
        </div>
        <button id="captureBtn" class="btn btn-main hidden" type="button">Ch·ª•p</button>
      </div>

      <!-- C·ªôt xem tr∆∞·ªõc ·∫£nh -->
      <div class="preview-col">
        <div id="imagePreview" class="image-preview" aria-label="Xem tr∆∞·ªõc ·∫£nh"></div>
      </div>
    </div>

    <!-- Khu v·ª±c hi·ªÉn th·ªã k·∫øt qu·∫£ -->
    <div id="result" class="result-box" aria-live="polite"></div>

    <!-- L·ªãch s·ª≠ nh·∫≠n di·ªán (to√†n c·ª•c) -->
    <div class="history-controls">
      <button id="toggleGlobalHistory" class="btn btn-accent btn-small" type="button">L·ªãch s·ª≠ nh·∫≠n di·ªán</button>
      <button id="clearGlobalHistory" class="btn btn-accent btn-small" type="button">Xo√°</button>
    </div>
    <div id="globalHistoryPanel" class="history-panel hidden" aria-hidden="true"></div>
  </div>

  <!-- Chatbot n·ªïi -->
  <button id="openChatbot" class="chatbot-fab" title="Chat v·ªõi AI" aria-label="M·ªü chatbot">üí¨</button>
  <div id="chatbotBox" class="chatbot-box" role="dialog" aria-modal="true" aria-labelledby="chatbotTitle">
    <div class="chatbot-header">
      <span id="chatbotTitle">ü§ñ FoodNinja AI Chatbot</span>
      <button id="closeChatbot" class="chatbot-close" aria-label="ƒê√≥ng">√ó</button>
    </div>
    <div class="chatbot-tools">
      <button id="toggleHistory" class="btn btn-accent btn-small" type="button">L·ªãch s·ª≠</button>
      <button id="clearHistory" class="btn btn-accent btn-small" type="button" title="Xo√° l·ªãch s·ª≠ chat trong tr√¨nh duy·ªát">Xo√°</button>
    </div>
    <div id="chatHistoryPanel" class="chat-history hidden" aria-hidden="true"></div>
    <div id="chatbotMessages" class="chatbot-messages">
      <div class="chatbot-msg chatbot-msg-ai">Xin ch√†o! B·∫°n mu·ªën h·ªèi g√¨ v·ªÅ ·∫©m th·ª±c, s·ª©c kh·ªèe, c√¥ng ngh·ªá?</div>
    </div>
    <form id="chatbotForm" class="chatbot-form" autocomplete="off">
      <label for="chatbotInput" class="sr-only">Nh·∫≠p c√¢u h·ªèi cho AI</label>
      <input type="text" id="chatbotInput" class="chatbot-input" placeholder="Nh·∫≠p c√¢u h·ªèi cho AI..." title="Nh·∫≠p c√¢u h·ªèi cho AI ƒë·ªÉ nh·∫≠n t∆∞ v·∫•n" required />
      <button type="submit" class="btn btn-main">G·ª≠i</button>
    </form>
  </div>

  <!-- Install banner (PWA) c·ªë ƒë·ªãnh d∆∞·ªõi m√†n h√¨nh -->
  <div id="installBanner" class="install-banner hidden" role="region" aria-label="C√†i ƒë·∫∑t ·ª©ng d·ª•ng">
    <div class="install-text" id="installText">C√†i ƒë·∫∑t FoodNinja ƒë·ªÉ d√πng nh∆∞ ·ª©ng d·ª•ng</div>
    <button id="installBtn" class="btn btn-main btn-install" type="button">T·∫£i ·ª©ng d·ª•ng</button>
  </div>

  <!-- Inline config for reliable loading -->
  <script>
    // Configuration for Food Ninja App
    const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    
    // API Configuration
    const API_CONFIG = {
        development: {
            BASE_URL: 'http://localhost:5000'
        },
        production: {
            BASE_URL: 'https://foodninja-backend.onrender.com'
        }
    };
    
    // Set global API base
    const currentConfig = isDevelopment ? API_CONFIG.development : API_CONFIG.production;
    window.API_BASE = currentConfig.BASE_URL;
    window.API_BASE_URL = currentConfig.BASE_URL;
    
    console.log('[Config] Environment:', isDevelopment ? 'Development' : 'Production');
    console.log('[Config] API Base URL:', window.API_BASE_URL);
  </script>
  
  <!-- Main application script -->
  <script src="main.js" defer></script>
  <script defer>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js').catch(console.error);
      });
    }
  </script>
</body>
</html>